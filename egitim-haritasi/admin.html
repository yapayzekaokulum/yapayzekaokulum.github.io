<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harita Yönetim Paneli - YZO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="data.js"></script> <!-- Load existing data -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-900 text-white min-h-screen p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1
                    class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                    <i class="fa-solid fa-map-location-dot mr-2"></i> Harita Yönetim Paneli
                </h1>
                <p class="text-slate-400 text-sm mt-1">Eğitim verilerini buradan düzenleyip 'Kaydet' ile güncelleyin.
                </p>
            </div>

            <div class="flex gap-4">
                <a href="index.html"
                    class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition">
                    <i class="fa-solid fa-eye"></i> Haritayı Gör
                </a>
                <button onclick="downloadData()"
                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition shadow-lg shadow-green-900/20">
                    <i class="fa-solid fa-download"></i> Güncel data.js İndir
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- City List -->
            <div
                class="lg:col-span-1 bg-slate-800 rounded-xl border border-slate-700 overflow-hidden flex flex-col h-[80vh]">
                <div class="p-4 border-b border-slate-700 bg-slate-900/50">
                    <input type="text" id="citySearch" placeholder="Şehir ara..."
                        class="w-full bg-slate-700 border-none rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-purple-500 placeholder-slate-400">
                </div>
                <div class="overflow-y-auto flex-1 p-2" id="cityList">
                    <!-- Cities injected here -->
                </div>
            </div>

            <!-- Edit Form -->
            <div class="lg:col-span-2">
                <div id="editorPanel"
                    class="hidden bg-slate-800 rounded-xl border border-slate-700 p-6 h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-white mb-1" id="editCityName">Şehir Adı</h2>
                            <span class="text-xs text-slate-400 bg-slate-900 px-2 py-1 rounded"
                                id="editCityCode">Code</span>
                        </div>
                        <div class="text-right">
                            <label class="text-sm text-slate-400 block mb-1">Toplam Sayı</label>
                            <input type="number" id="editCount"
                                class="bg-slate-900 border border-slate-600 rounded w-20 px-2 py-1 text-center font-bold text-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>

                    <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700 mb-6">
                        <h3 class="font-bold text-purple-400 mb-4 flex items-center">
                            <i class="fa-solid fa-list-ul mr-2"></i> Eğitim Detayları
                        </h3>

                        <div id="trainingsList" class="space-y-3 mb-4">
                            <!-- Training Items -->
                        </div>

                        <button onclick="addTrainingItem()"
                            class="w-full py-2 border border-dashed border-slate-600 text-slate-400 rounded-lg hover:border-purple-500 hover:text-purple-400 transition text-sm">
                            <i class="fa-solid fa-plus mr-1"></i> Yeni Eğitim Detayı Ekle
                        </button>
                    </div>

                    <div class="flex justify-end pt-4 border-t border-slate-700">
                        <button onclick="saveCurrentCity()"
                            class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition">
                            <i class="fa-solid fa-check mr-2"></i> Değişiklikleri Uygula
                        </button>
                    </div>
                </div>

                <div id="emptyState"
                    class="bg-slate-800 rounded-xl border border-slate-700 p-6 h-[80vh] flex flex-col items-center justify-center text-slate-500">
                    <i class="fa-solid fa-map-location-dot text-6xl mb-4 opacity-50"></i>
                    <p class="text-lg">Düzenlemek için soldaki listeden bir şehir seçin.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state handling
        let currentCityKey = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderCityList();

            // Search filter
            document.getElementById('citySearch').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                renderCityList(term);
            });
        });

        function renderCityList(filter = "") {
            const container = document.getElementById('cityList');
            container.innerHTML = "";

            Object.keys(trainingData).forEach(key => {
                const city = trainingData[key];
                if (city.name.toLowerCase().includes(filter)) {
                    const btn = document.createElement('button');
                    btn.className = `w-full text-left px-4 py-3 rounded-lg flex justify-between items-center hover:bg-slate-700 transition mb-1 ${currentCityKey === key ? 'bg-purple-900/50 border border-purple-500/50' : ''}`;
                    btn.onclick = () => loadCity(key);
                    btn.innerHTML = `
                        <span class="font-medium">${city.name}</span>
                        <span class="text-xs bg-slate-900 px-2 py-1 rounded-full ${city.count > 0 ? 'text-green-400' : 'text-slate-500'}">${city.count}</span>
                    `;
                    container.appendChild(btn);
                }
            });
        }

        function loadCity(key) {
            currentCityKey = key;
            const data = trainingData[key];

            document.getElementById('editorPanel').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');

            document.getElementById('editCityName').innerText = data.name;
            document.getElementById('editCityCode').innerText = key;
            document.getElementById('editCount').value = data.count;

            renderTrainings(data.trainings || []);

            // Re-render list to highlight active
            renderCityList(document.getElementById('citySearch').value.toLowerCase());
        }

        function renderTrainings(trainings) {
            const container = document.getElementById('trainingsList');
            container.innerHTML = "";

            trainings.forEach((t, index) => {
                const div = document.createElement('div');
                div.className = "bg-slate-800 p-3 rounded border border-slate-600 flex gap-2 items-start";
                div.innerHTML = `
                    <div class="flex-1 space-y-2">
                        <input type="text" placeholder="Eğitim Başlığı / Okul Adı" value="${t.title || ''}" class="training-title w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-purple-500">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Tarih" value="${t.date || ''}" class="training-date w-1/3 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs focus:ring-1 focus:ring-purple-500">
                            <input type="text" placeholder="Yer/Konum" value="${t.place || ''}" class="training-place w-2/3 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs focus:ring-1 focus:ring-purple-500">
                        </div>
                    </div>
                    <button onclick="removeTraining(${index})" class="text-red-400 hover:text-red-300 p-1"><i class="fa-solid fa-trash"></i></button>
                `;
                container.appendChild(div);
            });

            if (trainings.length === 0) {
                container.innerHTML = '<div class="text-center text-slate-500 text-sm py-2">Henüz detay eklenmemiş.</div>';
            }
        }

        function addTrainingItem() {
            const data = trainingData[currentCityKey];
            if (!data.trainings) data.trainings = [];
            data.trainings.push({ title: "", date: "", place: "" });
            renderTrainings(data.trainings);
        }

        function removeTraining(index) {
            const data = trainingData[currentCityKey];
            data.trainings.splice(index, 1);
            renderTrainings(data.trainings);
        }

        function saveCurrentCity() {
            if (!currentCityKey) return;

            const newCount = parseInt(document.getElementById('editCount').value) || 0;
            const trainingDivs = document.querySelectorAll('#trainingsList > div');

            const newTrainings = [];
            trainingDivs.forEach(div => {
                newTrainings.push({
                    title: div.querySelector('.training-title').value,
                    date: div.querySelector('.training-date').value,
                    place: div.querySelector('.training-place').value
                });
            });

            // Update Global Object
            trainingData[currentCityKey].count = newCount;
            trainingData[currentCityKey].trainings = newTrainings;

            // UI Feedback
            const btn = document.querySelector('button[onclick="saveCurrentCity()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check"></i> Kaydedildi!';
            btn.classList.add('bg-green-600');
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('bg-green-600');
            }, 1000);

            // Refesh List View numbers
            renderCityList(document.getElementById('citySearch').value.toLowerCase());
        }

        function downloadData() {
            const content = `const trainingData = ${JSON.stringify(trainingData, null, 4)};`;
            const blob = new Blob([content], { type: 'text/javascript' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            alert("data.js dosyanız indirildi! \n\nLütfen bu dosyayı projenizdeki 'egitim-haritasi/data.js' dosyası ile değiştirin ve değişiklikleri Github'a yükleyin.");
        }
    </script>
</body>

</html>