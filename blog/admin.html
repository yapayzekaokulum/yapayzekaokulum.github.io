<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Yönetimi | YZO Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="data.js"></script>
    <style>
        body {
            background-color: #0f172a;
            color: white;
        }

        .input-dark {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }
    </style>
</head>

<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">Blog Yönetimi</h1>
            <div class="flex gap-4">
                <a href="../admin/index.html" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Dashboard
                </a>
                <button onclick="saveToFile()" class="px-4 py-2 bg-green-600 rounded hover:bg-green-500">
                    <i class="fa-solid fa-save mr-2"></i> Kaydet (data.js)
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form -->
            <div class="lg:col-span-1 bg-slate-800 p-6 rounded-xl">
                <h2 class="text-xl font-semibold mb-4">Yazı Düzenle / Ekle</h2>
                <form id="postForm" onsubmit="handleSubmit(event)" class="space-y-4">
                    <input type="hidden" id="postId">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Başlık</label>
                        <input type="text" id="title" class="w-full p-2 rounded input-dark" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Kategori</label>
                        <select id="category" class="w-full p-2 rounded input-dark">
                            <option>Yapay Zeka</option>
                            <option>Eğitim</option>
                            <option>Yazılım</option>
                            <option>Araçlar</option>
                            <option>Kariyer</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Yazar</label>
                        <input type="text" id="author" class="w-full p-2 rounded input-dark" value="Dr. Murat Altun">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Tarih</label>
                        <input type="date" id="date" class="w-full p-2 rounded input-dark" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Okuma Süresi</label>
                        <input type="text" id="readTime" class="w-full p-2 rounded input-dark" placeholder="Örn: 5 dk">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Görsel URL</label>
                        <input type="url" id="image" class="w-full p-2 rounded input-dark" placeholder="https://...">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Özet (Excerpt)</label>
                        <textarea id="excerpt" rows="2" class="w-full p-2 rounded input-dark" required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">İçerik (HTML)</label>
                        <textarea id="content" rows="6" class="w-full p-2 rounded input-dark font-mono text-xs" placeholder="<p>Makale içeriği...</p>"></textarea>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="isNew">
                        <label for="isNew" class="text-sm">Yeni Etiketi</label>
                    </div>

                    <div class="flex gap-2 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 py-2 rounded hover:bg-blue-500">Kaydet</button>
                        <button type="button" onclick="resetForm()"
                            class="px-4 py-2 bg-gray-600 rounded hover:bg-gray-500">İptal</button>
                    </div>
                </form>
            </div>

            <!-- List -->
            <div class="lg:col-span-2 space-y-4">
                <div class="bg-slate-800 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-semibold">Toplam Yazı: <span id="count">0</span></span>
                </div>
                <div id="postList" class="space-y-4">
                    <!-- Posts injected here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let posts = [...blogPosts]; // from data.js

        function renderPosts() {
            const list = document.getElementById('postList');
            document.getElementById('count').textContent = posts.length;

            list.innerHTML = posts.map(post => `
                <div class="bg-slate-800 p-4 rounded-xl flex gap-4 items-center group hover:bg-slate-700 transition">
                    <img src="${post.image}" class="w-16 h-16 object-cover rounded-lg bg-gray-700">
                    <div class="flex-1">
                        <h3 class="font-bold flex items-center gap-2">
                            ${post.title}
                            ${post.isNew ? '<span class="text-xs bg-purple-600 px-2 rounded">YENİ</span>' : ''}
                        </h3>
                        <p class="text-sm text-gray-400">${post.category} • ${post.author} • ${post.date}</p>
                    </div>
                    <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                        <button onclick="editPost(${post.id})" class="p-2 bg-blue-600 rounded hover:bg-blue-500"><i class="fa-solid fa-pencil"></i></button>
                        <button onclick="deletePost(${post.id})" class="p-2 bg-red-600 rounded hover:bg-red-500"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function handleSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('postId').value;
            const newPost = {
                id: id ? parseInt(id) : Date.now(),
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                author: document.getElementById('author').value,
                date: document.getElementById('date').value,
                readTime: document.getElementById('readTime').value,
                image: document.getElementById('image').value,
                excerpt: document.getElementById('excerpt').value,
                content: document.getElementById('content').value,
                isNew: document.getElementById('isNew').checked
            };

            if (id) {
                const index = posts.findIndex(p => p.id == id);
                posts[index] = newPost;
            } else {
                posts.unshift(newPost);
            }

            renderPosts();
            resetForm();
        }

        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (!post) return;

            document.getElementById('postId').value = post.id;
            document.getElementById('title').value = post.title;
            document.getElementById('category').value = post.category;
            document.getElementById('author').value = post.author;
            document.getElementById('date').value = post.date;
            document.getElementById('readTime').value = post.readTime;
            document.getElementById('image').value = post.image;
            document.getElementById('excerpt').value = post.excerpt;
            document.getElementById('content').value = post.content || '';
            document.getElementById('isNew').checked = post.isNew || false;

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deletePost(id) {
            if (confirm('Bu yazıyı silmek istediğinize emin misiniz?')) {
                posts = posts.filter(p => p.id !== id);
                renderPosts();
            }
        }

        function resetForm() {
            document.getElementById('postForm').reset();
            document.getElementById('postId').value = '';
            document.getElementById('image').value = '';
        }

        async function saveToFile() {
            const content = `const blogPosts = ${JSON.stringify(posts, null, 4)};\n\nconst categories = ["Tümü", "Yapay Zeka", "Eğitim", "Yazılım", "Araçlar", "Kariyer"];`;

            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: 'data.js',
                    types: [{
                        description: 'JavaScript File',
                        accept: { 'text/javascript': ['.js'] }
                    }]
                });
                const writable = await handle.createWritable();
                await writable.write(content);
                await writable.close();
                alert('✅ data.js başarıyla kaydedildi!');
            } catch (err) {
                if (err.name !== 'AbortError') alert('Hata: ' + err.message);
            }
        }

        // Init
        renderPosts();
    </script>
</body>

</html>